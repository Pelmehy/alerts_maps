// let regions = [
//     {
//         'id': "Zhytomyr",
//         'name': 'Житомирська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Zaporizhia",
//         'name': 'Запорізька',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Zakarpattia",
//         'name': 'Закарпатська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Volyn",
//         'name': 'Волинська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Vinnytsia",
//         'name': 'Вінницька',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "IvanoFrankivsk",
//         'name': 'Івано-Франківська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Sumy",
//         'name': 'Сумська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Sevastopol",
//         'name': 'АР Крим',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Rivne",
//         'name': 'Рівненська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Ternopil",
//         'name': 'Тернопільська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Poltava",
//         'name': 'Полтавська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Odessa",
//         'name': 'Одеська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Mykolaiv",
//         'name': 'Миколаївська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Lviv",
//         'name': 'Львівська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Luhansk",
//         'name': 'Луганська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Kirovohrad",
//         'name': 'Кіровоградська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Kiev",
//         'name': 'Київська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "KievCity",
//         'name': 'Київ',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Khmelnytskyi",
//         'name': 'Хмельницька',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Kherson",
//         'name': 'Херсонська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Kharkiv",
//         'name': 'Харківська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Donetsk",
//         'name': 'Донецька',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Dnipropetrovsk",
//         'name': 'Дніпропетровська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Chernivtsi",
//         'name': 'Чернівецька',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Chernihiv",
//         'name': 'Чернігівська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//              {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Cherkasy",
//         'name': 'Черкаська',
//         'events': [
//             {
//                 'id': 'id',
//                 'title': 'title',
//                 'description': 'description'
//             },
//         ],
//     },
//     {
//         'id': "Crimea",
//         'name': 'АР Крим',
//         'events': [],
//     },
// ];
let regions = [
    {
        'id': "Zhytomyr",
        'name': 'Житомирська',
        'events': [
            
        ],
    },
    {
        'id': "Zaporizhia",
        'name': 'Запорізька',
        'events': [
            {
                'id': 'id',
                'title': 'title',
                'description': 'description'
            },
        ],
    },
    {
        'id': "Zakarpattia",
        'name': 'Закарпатська',
        'events': [
            
        ],
    },
    {
        'id': "Volyn",
        'name': 'Волинська',
        'events': [
            
        ],
    },
    {
        'id': "Vinnytsia",
        'name': 'Вінницька',
        'events': [
            {
                'id': 'id',
                'title': 'title',
                'description': 'description'
            },
        ],
    },
    {
        'id': "IvanoFrankivsk",
        'name': 'Івано-Франківська',
        'events': [
            
        ],
    },
    {
        'id': "Sumy",
        'name': 'Сумська',
        'events': [
            
        ],
    },
    {
        'id': "Sevastopol",
        'name': 'АР Крим',
        'events': [
            {
                'id': 'id',
                'title': 'title',
                'description': 'description'
            },
        ],
    },
    {
        'id': "Rivne",
        'name': 'Рівненська',
        'events': [
            
        ],
    },
    {
        'id': "Ternopil",
        'name': 'Тернопільська',
        'events': [
            
        ],
    },
    {
        'id': "Poltava",
        'name': 'Полтавська',
        'events': [
            
        ],
    },
    {
        'id': "Odessa",
        'name': 'Одеська',
        'events': [
            
        ],
    },
    {
        'id': "Mykolaiv",
        'name': 'Миколаївська',
        'events': [
            
        ],
    },
    {
        'id': "Lviv",
        'name': 'Львівська',
        'events': [
            {
                'id': 'id',
                'title': 'title',
                'description': 'description'
            },
        ],
    },
    {
        'id': "Luhansk",
        'name': 'Луганська',
        'events': [
            
        ],
    },
    {
        'id': "Kirovohrad",
        'name': 'Кіровоградська',
        'events': [
            
        ],
    },
    {
        'id': "Kiev",
        'name': 'Київська',
        'events': [
            
        ],
    },
    {
        'id': "KievCity",
        'name': 'Київ',
        'events': [
            
        ],
    },
    {
        'id': "Khmelnytskyi",
        'name': 'Хмельницька',
        'events': [
            
        ],
    },
    {
        'id': "Kherson",
        'name': 'Херсонська',
        'events': [
            
        ],
    },
    {
        'id': "Kharkiv",
        'name': 'Харківська',
        'events': [
            
        ],
    },
    {
        'id': "Donetsk",
        'name': 'Донецька',
        'events': [
            
        ],
    },
    {
        'id': "Dnipropetrovsk",
        'name': 'Дніпропетровська',
        'events': [
            
        ],
    },
    {
        'id': "Chernivtsi",
        'name': 'Чернівецька',
        'events': [
            
        ],
    },
    {
        'id': "Chernihiv",
        'name': 'Чернігівська',
        'events': [
            
             
        ],
    },
    {
        'id': "Cherkasy",
        'name': 'Черкаська',
        'events': [
            
        ],
    },
    {
        'id': "Crimea",
        'name': 'АР Крим',
        'events': [],
    },
];

function set_regions(new_regions) {
    regions = new_regions;
}


let areas_attrs = {};

function prepare_areas(regions) {
    Object.values(regions).forEach(region => {
        let area_attrs = {}

        let area_info = {
            text: {content: region.name, attrs: {'font-size': 6, 'fill': '#ffffff'}},
            attrs: area_attrs,
        }

        if (region.id === 'Kiev') {
            area_info.text.attrs['transform']  = 't0,15';
        }

        if (region.events.length > 0) {
            area_info['attrs']['fill'] = '#8f0d11';
            area_info['tooltip'] = prepare_popups(region);
        } else {
             area_info['attrs']['fill'] = '#343434';
        }

        areas_attrs[region.id] = area_info
    });

    return areas_attrs;
}

function prepare_popups(region) {
    return {
            content: "<span style=\"font-weight:bold;\">Область:</span>" + region.name + "<br>" +
                "<span style=\"font-weight:bold;\">Кількість ЧС:</span>" + region.events.length
        };
}

function select_area(id, mapElem, region) {
    areas_attrs = prepare_areas(regions)

    if (mapElem.originalAttrs.fill === "#246134") {
        let fill_color = region.events.length > 0
        ? '#8f0d11'
        : '#343434';

        areas_attrs[id].attrs.fill = fill_color;
    } else {
        areas_attrs[id].attrs.fill = '#246134';
    }

    $(".mapcontainer").trigger('update', [{mapOptions: {areas: areas_attrs}}]);
}

function display_area_events(region) {
    let area_events = $('#area_events');
    area_events.html('');

    $('#area_events_header').html(`
    <h3 class="card-title">
        <i class="fas fa-bullhorn"></i>
        Надзвичайні події
    </h3>
    <br>
    <h3 class="card-title mt-3">
        <i class="fas fa-city"></i>
        ${region.name} область
    </h3>
    `)

    $('#city_name').val(region.id)
    let alert_cards = '';
    region.events.forEach(region_event => {
        alert_cards += `
        <div class="callout callout-danger">
            <h5>${region_event.title}</h5>
            <p>${region_event.description}</p>
            <a type="button" href="delete_event/${region_event.id}" class="btn btn-block btn-danger">Видалити</a>
        </div>
        `
    });
    area_events.html(alert_cards)
}

$(function () {
    $(".mapcontainer").mapael({
        map: {
            name: "ukraine",
            // Enable zoom on the map,
            zoom: {
                enabled: true,
                maxLevel: 10
            },
            // Set default plots and areas style,
            defaultPlot: {
                attrs: {
                    fill: "#004a9b",
                    opacity: 0.6
                },
                attrsHover: {
                    opacity: 1
                },
                text: {
                    attrs: {
                        fill: "#505444"
                    },
                    attrsHover: {
                        fill: "#000"
                    }
                },
            },
            defaultArea: {
                attrsHover: {
                    fill: "#a4e100"
                },
                text: {
                    attrs: {
                        fill: "#505444"
                    },
                    attrsHover: {
                        fill: "#000"
                    }
                },
                eventHandlers: {
                    click: function (e, id, mapElem, textElem) {
                        let region = regions.find(x => x.id === id)

                        select_area(id, mapElem, region)      ;
                        display_area_events(region);
                    }
                }
            }
        },

        // Customize some areas of the map
        areas: prepare_areas(regions),
    });
})
